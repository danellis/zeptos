#pragma once
#include <stdint.h>

#define REGISTER(addr) (*(volatile uint32_t *)(addr))

#define GPIOA_BASE 0x40020000
#define GPIOA_MODER REGISTER(GPIOA_BASE + 0x00)
#define GPIOA_OTYPER REGISTER(GPIOA_BASE + 0x04)
#define GPIOA_OSPEEDR REGISTER(GPIOA_BASE + 0x08)
#define GPIOA_PUPDR REGISTER(GPIOA_BASE + 0x0c)
#define GPIOA_ODR REGISTER(GPIOA_BASE + 0x14)
#define GPIOA_AFRL REGISTER(GPIOA_BASE + 0x20)
#define GPIOA_AFRH REGISTER(GPIOA_BASE + 0x24)

#define GPIOB_BASE 0x40020400
#define GPIOB_MODER REGISTER(GPIOB_BASE + 0x00)
#define GPIOB_OTYPER REGISTER(GPIOB_BASE + 0x04)
#define GPIOB_OSPEEDR REGISTER(GPIOB_BASE + 0x08)
#define GPIOB_PUPDR REGISTER(GPIOB_BASE + 0x0c)
#define GPIOB_ODR REGISTER(GPIOB_BASE + 0x14)
#define GPIOB_AFRL REGISTER(GPIOB_BASE + 0x20)
#define GPIOB_AFRH REGISTER(GPIOB_BASE + 0x24)

#define GPIOC_BASE 0x40020800
#define GPIOC_MODER REGISTER(GPIOC_BASE + 0x00)

#define RCC_BASE 0x40023800

#define RCC_CR REGISTER(RCC_BASE + 0x00)
#define RCC_CR_HSEON (1 << 16)
#define RCC_CR_HSERDY (1 << 17)
#define RCC_CR_PLLON (1 << 24)
#define RCC_CR_PLLRDY (1 << 25)

#define RCC_PLLCFGR REGISTER(RCC_BASE + 0x04)
#define RCC_PLLCFGR_RESERVED_MASK 0b11110000101111001000000000000000
#define RCC_PLLCFGR_PLLM_BIT 0
#define RCC_PLLCFGR_PLLN_BIT 6
#define RCC_PLLCFGR_PLLP_BIT 16
#define RCC_PLLCFGR_PLLSRC (1 << 22)
#define RCC_PLLCFGR_PLLQ_BIT 24

#define RCC_CFGR REGISTER(RCC_BASE + 0x08)
#define RCC_CFGR_SW_BIT 0
#define RCC_CFGR_SWS_BIT 2
#define RCC_CFGR_HPRE_BIT 4
#define RCC_CFGR_PPRE1_BIT 10
#define RCC_CFGR_MCO1PRE_BIT 24
#define RCC_CFGR_MCO2PRE_BIT 27

#define RCC_AHB1ENR REGISTER(RCC_BASE + 0x30)
#define RCC_AHB1ENR_GPIOAEN (1 << 0)
#define RCC_AHB1ENR_GPIOBEN (1 << 1)
#define RCC_AHB1ENR_GPIOCEN (1 << 2)

#define RCC_APB1ENR REGISTER(RCC_BASE + 0x40)
#define RCC_APB1ENR_SPI2EN (1 << 14)
#define RCC_APB1ENR_USART2EN (1 << 17)

#define RCC_APB2ENR REGISTER(RCC_BASE + 0x44)
#define RCC_APB2ENR_USART1EN (1 << 4)
#define RCC_APB2ENR_USART6EN (1 << 5)

#define FLASH_BASE 0x40023C00
#define FLASH_ACR REGISTER(FLASH_BASE + 0x00)
#define FLASH_ACR_LATENCY_BIT 0
#define FLASH_ACR_PRFTEN (1 << 8)
#define FLASH_ACR_ICEN (1 << 9)
#define FLASH_ACR_DCEN (1 << 10)

#define NVIC_ISER0 0xE000E100

#define SYST_CSR REGISTER(0xE000E010)
#define SYST_CSR_COUNTFLAG (1 << 16)

#define SYST_RVR REGISTER(0xE000E014)
#define SYST_CVR REGISTER(0xE000E018)

#define USART1_BASE 0x40011000
#define USART1_SR REGISTER(USART1_BASE + 0x00)
#define USART1_DR REGISTER(USART1_BASE + 0x04)
#define USART1_BRR REGISTER(USART1_BASE + 0x08)
#define USART1_CR1 REGISTER(USART1_BASE + 0x0c)
#define USART1_CR2 REGISTER(USART1_BASE + 0x10)

#define USART2_BASE 0x40004400
#define USART2_SR REGISTER(USART2_BASE + 0x00)
#define USART2_DR REGISTER(USART2_BASE + 0x04)
#define USART2_BRR REGISTER(USART2_BASE + 0x08)
#define USART2_CR1 REGISTER(USART2_BASE + 0x0c)
#define USART2_CR2 REGISTER(USART2_BASE + 0x10)

#define USART_SR_TC (1 << 6)
#define USART_SR_TXE (1 << 7)

#define USART_CR1_OVER8 (1 << 15)
#define USART_CR1_UE (1 << 13)
#define USART_CR1_M (1 << 12)
#define USART_CR1_TE (1 << 3)
#define USART_CR1_RE (1 << 2)

#define SPI2_BASE 0x40003800
#define SPI2_CR1 REGISTER(SPI2_BASE + 0x00)
#define SPI2_SR REGISTER(SPI2_BASE + 0x08)
#define SPI2_DR REGISTER(SPI2_BASE + 0x0c)
#define SPI2_CRCPR REGISTER(SPI2_BASE + 0x10)
#define SPI2_RXCRCR REGISTER(SPI2_BASE + 0x14)
#define SPI2_TXCRCR REGISTER(SPI2_BASE + 0x18)
#define SPI2_I2SCFGR REGISTER(SPI2_BASE + 0x1c)
#define SPI2_I2SPR REGISTER(SPI2_BASE + 0x20)

#define SPI_CR1_CPHA (1 << 0)
#define SPI_CR1_CPOL (1 << 1)
#define SPI_CR1_MSTR (1 << 2)
#define SPI_CR1_BR(x) (x << 3)
#define SPI_CR1_BR_MASK (0b111 << 3)
#define SPI_CR1_SPE (1 << 6)

#define SPI_SR_RXNE (1 << 0)
#define SPI_SR_TXE (1 << 1)
#define SPI_SR_BSY (1 << 7)
